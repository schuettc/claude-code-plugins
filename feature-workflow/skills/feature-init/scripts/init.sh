#!/bin/bash
# Initialize feature-workflow directory structure
#
# Usage: init-feature-workflow.sh [project-root]
#
# Creates:
#   docs/features/
#   docs/features/DASHBOARD.md (initial template)

set -euo pipefail

PROJECT_ROOT="${1:-$PWD}"
FEATURES_DIR="$PROJECT_ROOT/docs/features"

# Check if already initialized
if [[ -d "$FEATURES_DIR" ]]; then
  echo "Feature workflow already initialized at $FEATURES_DIR"

  # Count existing features
  FEATURE_COUNT=$(find "$FEATURES_DIR" -mindepth 1 -maxdepth 1 -type d 2>/dev/null | wc -l | tr -d ' ')

  if [[ -f "$FEATURES_DIR/DASHBOARD.md" ]]; then
    echo "DASHBOARD.md exists"
  fi

  echo "Found $FEATURE_COUNT feature directories"
  exit 0
fi

# Create directory structure
echo "Initializing feature-workflow..."
mkdir -p "$FEATURES_DIR"

# Create initial DASHBOARD.md
cat > "$FEATURES_DIR/DASHBOARD.md" << 'EOF'
# Feature Dashboard

*Auto-generated by hooks. Do not edit directly.*

## In Progress

*No features in progress*

## Backlog

*No features in backlog. Use `/feature-capture` to add one.*

## Completed

*No completed features*
EOF

echo ""
echo "Feature workflow initialized!"
echo ""
echo "Directory: $FEATURES_DIR"
echo ""
echo "Next steps:"
echo "  /feature-capture  - Add a feature to the backlog"
echo "  /feature-plan     - Start implementing a feature"
echo "  /feature-ship     - Complete a feature"
echo ""
